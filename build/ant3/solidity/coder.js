"use strict";var f=require("./formatters"),SolidityTypeAddress=require("./address"),SolidityTypeIdentity=require("./identity"),SolidityTypeBool=require("./bool"),SolidityTypeInt=require("./int"),SolidityTypeUInt=require("./uint"),SolidityTypeDynamicBytes=require("./dynamicbytes"),SolidityTypeString=require("./string"),SolidityTypeReal=require("./real"),SolidityTypeUReal=require("./ureal"),SolidityTypeBytes=require("./bytes"),isDynamic=function(e,t){return e.isDynamicType(t)||e.isDynamicArray(t)},SolidityCoder=function(e){this._types=e};SolidityCoder.prototype._requireType=function(t){var e=this._types.filter(function(e){return e.isType(t)})[0];if(!e)throw Error("invalid solidity type!: "+t);return e},SolidityCoder.prototype.encodeParam=function(e,t){return this.encodeParams([e],[t])},SolidityCoder.prototype.encodeParams=function(n,i){var y=this.getSolidityTypes(n),e=y.map(function(e,t){return e.encode(i[t],n[t])}),t=y.reduce(function(e,t,i){var r=t.staticPartLength(n[i]),o=32*Math.floor((r+31)/32);return e+(isDynamic(y[i],n[i])?32:o)},0);return this.encodeMultiWithOffset(n,y,e,t)},SolidityCoder.prototype.encodeMultiWithOffset=function(r,o,n,y){var d="",a=this;return r.forEach(function(e,t){if(isDynamic(o[t],r[t])){d+=f.formatInputInt(y).encode();var i=a.encodeWithOffset(r[t],o[t],n[t],y);y+=i.length/2}else d+=a.encodeWithOffset(r[t],o[t],n[t],y)}),r.forEach(function(e,t){if(isDynamic(o[t],r[t])){var i=a.encodeWithOffset(r[t],o[t],n[t],y);y+=i.length/2,d+=i}}),d},SolidityCoder.prototype.encodeWithOffset=function(e,t,i,r){var o=1,n=2,y=3,d=t.isDynamicArray(e)?o:t.isStaticArray(e)?n:y;if(d===y)return i;var a=t.nestedName(e),s=t.staticPartLength(a),c=d===o?i[0]:"";if(t.isDynamicArray(a))for(var u=d===o?2:0,l=0;l<i.length;l++)d===o?u+=+i[l-1][0]||0:d===n&&(u+=+(i[l-1]||[])[0]||0),c+=f.formatInputInt(r+l*s+32*u).encode();for(var p=d===o?i.length-1:i.length,S=0;S<p;S++){var h=c/2;d===o?c+=this.encodeWithOffset(a,t,i[S+1],r+h):d===n&&(c+=this.encodeWithOffset(a,t,i[S],r+h))}return c},SolidityCoder.prototype.decodeParam=function(e,t){return this.decodeParams([e],t)[0]},SolidityCoder.prototype.decodeParams=function(i,r){var e=this.getSolidityTypes(i),o=this.getOffsets(i,e);return e.map(function(e,t){return e.decode(r,o[t],i[t],t)})},SolidityCoder.prototype.getOffsets=function(i,r){for(var e=r.map(function(e,t){return e.staticPartLength(i[t])}),t=1;t<e.length;t++)e[t]+=e[t-1];return e.map(function(e,t){return e-r[t].staticPartLength(i[t])})},SolidityCoder.prototype.getSolidityTypes=function(e){var t=this;return e.map(function(e){return t._requireType(e)})};var coder=new SolidityCoder([new SolidityTypeAddress,new SolidityTypeIdentity,new SolidityTypeBool,new SolidityTypeInt,new SolidityTypeUInt,new SolidityTypeDynamicBytes,new SolidityTypeBytes,new SolidityTypeString,new SolidityTypeReal,new SolidityTypeUReal]);module.exports=coder;