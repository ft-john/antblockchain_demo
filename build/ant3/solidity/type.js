"use strict";var f=require("./formatters"),SolidityParam=require("./param"),SolidityType=function(t){this._inputFormatter=t.inputFormatter,this._outputFormatter=t.outputFormatter};SolidityType.prototype.isType=function(t){throw"this method should be overrwritten for type "+t},SolidityType.prototype.staticPartLength=function(t){return(this.nestedTypes(t)||["[1]"]).map(function(t){return parseInt(t.slice(1,-1),10)||1}).reduce(function(t,e){return t*e},32)},SolidityType.prototype.isDynamicArray=function(t){var e=this.nestedTypes(t);return!!e&&!e[e.length-1].match(/[0-9]{1,}/g)},SolidityType.prototype.isStaticArray=function(t){var e=this.nestedTypes(t);return!!e&&!!e[e.length-1].match(/[0-9]{1,}/g)},SolidityType.prototype.staticArrayLength=function(t){var e=this.nestedTypes(t);return e?parseInt(e[e.length-1].match(/[0-9]{1,}/g)||1):1},SolidityType.prototype.nestedName=function(t){var e=this.nestedTypes(t);return e?t.substr(0,t.length-e[e.length-1].length):t},SolidityType.prototype.isDynamicType=function(){return!1},SolidityType.prototype.nestedTypes=function(t){return t.match(/(\[[0-9]*\])/g)},SolidityType.prototype.encode=function(n,o){var t,e,r,s=this;return this.isDynamicArray(o)?(t=n.length,e=s.nestedName(o),(r=[]).push(f.formatInputInt(t).encode()),n.forEach(function(t){r.push(s.encode(t,e))}),r):this.isStaticArray(o)?function(){for(var t=s.staticArrayLength(o),e=s.nestedName(o),r=[],i=0;i<t;i++)r.push(s.encode(n[i],e));return r}():this._inputFormatter(n,o).encode()},SolidityType.prototype.decode=function(p,u,y){var t,e,r,i,c=this;if(this.isDynamicArray(y))return function(){for(var t=parseInt("0x"+p.substr(2*u,64)),e=parseInt("0x"+p.substr(2*t,64)),r=t+32,i=c.nestedName(y),n=c.staticPartLength(i),o=32*Math.floor((n+31)/32),s=[],a=0;a<e*o;a+=o)s.push(c.decode(p,r+a,i));return s}();if(this.isStaticArray(y))return function(){for(var t=c.staticArrayLength(y),e=u,r=c.nestedName(y),i=c.staticPartLength(r),n=32*Math.floor((i+31)/32),o=[],s=0;s<t*n;s+=n)o.push(c.decode(p,e+s,r));return o}();if(this.isDynamicType(y))return t=parseInt("0x"+p.substr(2*u,64)),e=parseInt("0x"+p.substr(2*t,64)),r=Math.floor((e+31)/32),i=new SolidityParam(p.substr(2*t,64*(1+r)),0),c._outputFormatter(i,y);var n=this.staticPartLength(y),o=new SolidityParam(p.substr(2*u,2*n));return this._outputFormatter(o,y)},module.exports=SolidityType;